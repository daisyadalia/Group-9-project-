#include <iostream>
#include <iomanip>
#include <vector>
#include <string>
#include <algorithm> 
#include <fstream>   
using namespace std;


const int MAX_STUDENTS_PER_GROUP = 50;
const int MAX_STUDENTS_PER_SPORT = 20;
const int MAX_MEMBERS_PER_CLUB = 60;
const double MAX_PERCENTAGE_MALE_SPORT = 0.75;
const double MAX_PERCENTAGE_MALE_CLUB = 0.5;


struct Student {
    string firstname;
    string surname;
    string gender;
    int age;
    int bbitGroup;
    int sportIndex;           
    vector<int> clubIndices;  
};

struct Activity {
    string name;
    int currentCapacity;
    int maxCapacity;
    vector<int> members;  
};


vector<Student> students;
vector<Activity> sports;
vector<Activity> clubsSocieties;


void displayMenu();
void addStudent();
void viewStudents();
void viewClubsSocieties();
void viewSports();
void viewGroupedStudents();
void saveData();
void assignActivity(Student& student);
bool isMaleExceedPercentage(const Activity& activity, const Student& student, double maxPercentage);
void displayActivities(const vector<Activity>& activities);
void displayStudentsByGroup(int group);
void loadData(); 

int main() {
    loadData();  

    int choice;
    do {
        displayMenu();
        cin >> choice;

        switch (choice) {
            case 1:
                addStudent();
                break;
            case 2:
                viewStudents();
                break;
            case 3:
                viewClubsSocieties();
                break;
            case 4:
                viewSports();
                break;
            case 5:
                viewGroupedStudents();
                break;
            case 6:
                saveData();
                break;
            case 7:
                cout << "Exiting program..." << endl;
                break;
            default:
                cout << "Invalid choice. Please enter a valid option." << endl;
        }
    } while (choice != 7);

    return 0;
}

void displayMenu() {
    cout << "===== Co-curricular Activities Management =====" << endl;
    cout << "1. Add Student" << endl;
    cout << "2. View Students" << endl;
    cout << "3. View Clubs/Societies" << endl;
    cout << "4. View Sports" << endl;
    cout << "5. View Grouped Students" << endl;
    cout << "6. Save all Files" << endl;
    cout << "7. Exit" << endl;
    cout << "Enter your choice: ";
}

void addStudent() {
    Student newStudent;
    cout << "Enter firstname: ";
    cin >> newStudent.firstname;
    cout << "Enter surname: ";
    cin >> newStudent.surname;
    cout << "Enter gender (Male/Female): ";
    cin >> newStudent.gender;
    cout << "Enter age: ";
    cin >> newStudent.age;
    cout << "Enter BBIT group (1, 2, or 3): ";
    cin >> newStudent.bbitGroup;

    // Check if student already exists
    auto it = find_if(students.begin(), students.end(), [&](const Student& s) {
        return s.firstname == newStudent.firstname && s.surname == newStudent.surname;
    });
    if (it != students.end()) {
        cout << "Student already exists!" << endl;
        return;
    }

    // Assign activities to the student
    assignActivity(newStudent);

    // Add the student to the students vector
    students.push_back(newStudent);

    cout << "Student added successfully!" << endl;
}

void viewStudents() {
    if (students.empty()) {
        cout << "No students to display." << endl;
        return;
    }

    cout << "===== Students =====" << endl;
    cout << setw(20) << "Name" << setw(10) << "Gender" << setw(5) << "Age" << setw(15) << "Sport" << setw(20) << "Clubs/Societies" << endl;

    for (const auto& student : students) {
        cout << setw(20) << student.firstname + " " + student.surname << setw(10) << student.gender << setw(5) << student.age;

        if (student.sportIndex != -1) {
            cout << setw(15) << sports[student.sportIndex].name;
        } else {
            cout << setw(15) << "-";
        }

        if (!student.clubIndices.empty()) {
            string clubs;
            for (int clubIndex : student.clubIndices) {
                clubs += clubsSocieties[clubIndex].name + ", ";
            }
            clubs = clubs.substr(0, clubs.size() - 2);  
            cout << setw(20) << clubs;
        } else {
            cout << setw(20) << "-";
        }

        cout << endl;
    }
}

void viewClubsSocieties() {
    if (clubsSocieties.empty()) {
        cout << "No clubs/societies available." << endl;
        return;
    }

    cout << "===== Clubs/Societies =====" << endl;
    displayActivities(clubsSocieties);
}

void viewSports() {
    if (sports.empty()) {
        cout << "No sports available." << endl;
        return;
    }

    cout << "===== Sports =====" << endl;
    displayActivities(sports);
}

void viewGroupedStudents() {
    if (students.empty()) {
        cout << "No students to display." << endl;
        return;
    }

    cout << "===== Grouped Students =====" << endl;
    cout << "BBIT Group 1:" << endl;
    displayStudentsByGroup(1);
    cout << endl << "BBIT Group 2:" << endl;
    displayStudentsByGroup(2);
    cout << endl << "BBIT Group 3:" << endl;
    displayStudentsByGroup(3);
}

void saveData() {
    ofstream outFile("students_data.csv");
    if (!outFile) {
        cerr << "Error opening file for writing." << endl;
        return;
    }


